jQuery(document).ready(function($){function detectIE(){var e=window.navigator.userAgent,s=e.indexOf("MSIE ");if(s>0)return!0;var i=e.indexOf("Trident/");return i>0?!0:!1}function ieFix(e){$(e).find("#fca_qc_back_container").css("backface-visibility","visible"),$(e).find("#fca_qc_back_container").css("transform","none"),$(e).find("#fca_qc_back_container").hide(),svg_square='<svg xmlns="http://www.w3.org/2000/svg" class="fca_qc_rectancle" width="26" height="26"><rect style="fill: #fff; stroke: #000; stroke-width: 1;" width="26" height="26" /></svg>'}function loadQuizzes(){$(".fca_qc_quiz").each(function(index){var thisId=get_quiz_id(this);thisId&&(quizzes[thisId]=eval("quizData_"+thisId),quizzes[thisId].selector=this,default_img=quizzes[thisId].default_img)}),$.each(quizzes,function(e){$.each(quizzes[e].questions,function(s){quizzes[e].questions[s].answers=quizzes[e].questions[s].answers.filter(function(e){return""!==e.answer||""!==e.img}),quizzes[e].questions[s].hasOwnProperty("answers")&&0!==quizzes[e].questions[s].answers.length||quizzes[e].questions.splice(s)})}),$.each(quizzes,function(e){"on"===quizzes[e].quiz_settings.shuffle_questions&&(quizzes[e].questions=shuffleArray(quizzes[e].questions))})}function preloadImages(){$.each(quizzes,function(e){quizzes[e].questions[0]&&lazyLoadQuestion(quizzes[e].questions[0])})}function lazyLoadResults(e){e.hasOwnProperty("quiz_results")&&$.each(e.quiz_results,function(s){e.quiz_results[s].hasOwnProperty("img")&&lazyLoadImage(e.quiz_results[s].img)})}function lazyLoadImage(e){if(""!==e&&void 0!==e&&"string"==typeof e){var s=new Image;s.src=e}}function lazyLoadQuestion(e){e.hasOwnProperty("img")&&lazyLoadImage(e.img),e.hasOwnProperty("answers")&&$.each(e.answers,function(s){e.answers[s].hasOwnProperty("img")&&lazyLoadImage(e.answers[s].img)})}function get_quiz_id(e){var s=$(e).attr("id");return s?s.replace(/\D+/g,""):!1}function showQuestion(e){if(e.currentQuestion<e.questionCount){$(e.selector).find(".fca_qc_question_count").html(e.currentQuestion+1+"/"+e.questionCount);var s=e.questions[e.currentQuestion].question;$(e.selector).find("#fca_qc_question").html(s),$(e.selector).find("#fca_qc_question_back").html(s);var i=e.questions[e.currentQuestion].img;$(e.selector).find("#fca_qc_answer_container").find(".fca_qc_quiz_question_img").attr("src",i),$(e.selector).find("#fca_qc_back_container").find(".fca_qc_quiz_question_img").attr("src",i),$(e.selector).find("#fca_qc_answer_container").data("id",e.questions[e.currentQuestion].id);var t;"mc"===e.quiz_settings.quiz_type&&(t=e.questions[e.currentQuestion].answers[0]);var n=shuffleArray(e.questions[e.currentQuestion].answers);e.currentQuestion+1<e.questionCount?lazyLoadQuestion(e.questions[e.currentQuestion+1]):lazyLoadResults(e),$(e.selector).find(".fca_qc_answer_div").hide();for(var c=0;c<n.length;c++)(""!==n[c].img||""!==n[c].answer)&&("mc"===e.quiz_settings.quiz_type&&n[c].answer===t.answer&&n[c].img===t.img&&(e.currentAnswer=$(e.selector).find(".fca_qc_answer_div").eq(c).attr("data-question")),"pt"===e.quiz_settings.quiz_type&&$(e.selector).find(".fca_qc_answer_div").eq(c).data("results",n[c].results),$(e.selector).find(".fca_qc_answer_div").eq(c).find(".fca_qc_quiz_answer_img").attr("src",n[c].img),$(e.selector).find(".fca_qc_answer_div").eq(c).find(".fca_qc_answer_span").html(svg_square+n[c].answer),$(e.selector).find(".fca_qc_answer_div").eq(c).data("id",n[c].id),$(e.selector).find(".fca_qc_answer_div").eq(c).show());$(e.selector).find("#fca_qc_answer_container").waitForImages(function(){maybe_add_quarter_class(e.selector),scale_flip_box_question(e.selector)}),e.currentQuestion=e.currentQuestion+1}else endTest(e)}function maxHeightOfElementSet(e){var s=0;return $.each(e,function(i){e.eq(i).outerHeight()>s&&(s=e.eq(i).outerHeight())}),s}function scale_flip_box_question(e){var s=$(e).find("#fca_qc_question").outerHeight(!0);s+=$(e).find(".fca_qc_quiz_question_img").outerHeight(!0);var i=0,t=0;$(e).find(".fca_qc_answer_div:visible").eq(0).hasClass("fca-qc-twoup")?(t=maxHeightOfElementSet($(e).find(".fca_qc_answer_div:visible")),i=$(e).find(".fca_qc_answer_div:visible").length,i=Math.floor(i/2)+i%2,s+=t*i):$(e).find(".fca_qc_answer_div:visible").eq(0).hasClass("fca-qc-threeup")?(t=maxHeightOfElementSet($(e).find(".fca_qc_answer_div:visible")),i=$(e).find(".fca_qc_answer_div:visible").length,i/=3,s+=t*i):$(e).find(".fca_qc_answer_div:visible").each(function(){s+=$(this).outerHeight(!0)}),200>s&&(s=200),$(e).find(".fca_qc_quiz_div, #fca_qc_answer_container, #fca_qc_back_container").outerHeight(s)}function scale_flip_box_back(e){var s=0;$(e).find("#fca_qc_back_container").children().each(function(){$(this).is(":visible")&&(s+=$(this).outerHeight(!0))}),s+=35,400>s&&(s=400),$(e).find(".fca_qc_quiz_div, #fca_qc_answer_container, #fca_qc_back_container").height(s)}function maybe_add_quarter_class(e){$(e).find(".fca_qc_answer_div").height("auto"),$(e).find(".fca_qc_answer_div").removeClass("fca-qc-twoup fca-qc-threeup"),$(e).find(".fca_qc_quiz_answer_img").css("marginBottom",0);var s=!0,i=0;if($(e).find(".fca_qc_answer_div:visible").each(function(){return i++,""!==$(this).find(".fca_qc_quiz_answer_img").attr("src")&&s?void 0:(s=!1,!1)}),s){var t="fca-qc-twoup";i%3===0&&0===$(e).find(".fca_qc_mobile_check:visible").length&&(t="fca-qc-threeup"),$(e).find(".fca_qc_answer_div").addClass(t);var n=maxHeightOfElementSet($(e).find(".fca_qc_quiz_answer_img:visible"));n>200&&(n=200),$(e).find(".fca_qc_quiz_answer_img:visible").each(function(){$(this).css("marginBottom",n-$(this).height()+10+"px")});var c=maxHeightOfElementSet($(e).find(".fca_qc_answer_div:visible"));return $(e).find(".fca_qc_answer_div:visible").outerHeight(c),!0}return!1}function set_result(e){var s="undefined";if("pt"===e.quiz_settings.quiz_type){var i=-1,t=[];$.each(e.quiz_results,function(e,s){s.hasOwnProperty("score")&&s.score>i&&(i=s.score)}),$.each(e.quiz_results,function(e,s){s.hasOwnProperty("score")&&s.score===i&&t.push(s)}),0===t.length&&(t=e.quiz_results),$(e.selector).find(".fca_qc_score_text").hide(),s=t[Math.floor(Math.random()*t.length)]}else{for(var n=0;"undefined"===s;)e.quiz_results[n].min<=e.score&&e.quiz_results[n].max>=e.score?s=e.quiz_results[n]:n===e.quiz_results.length?s="error":n++;var c=scoreString.replace("{{SCORE_CORRECT}}",e.score);c=c.replace("{{SCORE_TOTAL}}",e.questionCount),$(e.selector).find(".fca_qc_score_text").html(c)}return $(e.selector).find(".fca_qc_score_title").html(s.title),$(e.selector).find(".fca_qc_score_img").attr("src",s.img),$(e.selector).find(".fca_qc_score_desc").html(s.desc),s.hasOwnProperty("id")?add_result(e.ajaxurl,e.nonce,e.quiz_id,s.id):add_result(e.ajaxurl,e.nonce,e.quiz_id,e.score),s}function show_responses(e){for(var s,i=0;i<e.questions.length;i++)s="",s+=e.responses[i].isCorrect?"<div class='fca_qc_question_response_item correct-answer'>":"<div class='fca_qc_question_response_item wrong-answer'>",s+="<h3 class='fca_qc_question_response_question'>"+(i+1)+". "+e.questions[i].question+"</h3>",s+="<img class='fca_qc_quiz_question_img' src='"+e.questions[i].img+"'>",s+="<p class='fca_qc_question_response_response'><span class='fca_qc_bold'>"+e.your_answer_string+" </span>"+e.responses[i].answer+"</p>",s+="<p class='fca_qc_question_response_correct_answer'><span class='fca_qc_bold'>"+e.correct_answer_string+" </span>"+e.responses[i].correctAnswer+"</p>",e.responses[i].hasOwnProperty("hint")&&(s+="<p class='fca_qc_question_response_hint'>"+e.responses[i].hint+"</p>"),s+="</div>",$(e.selector).find(".fca_qc_insert_response_above").before(s);$(e.selector).find(".fca_qc_your_answer_container").show()}function endTest(e){add_activity(e.ajaxurl,e.nonce,e.quiz_id,"completions"),$(e.selector).find(".fca_qc_quiz_footer").hide(),$(e.selector).find(".fca_qc_quiz_div").hide(),"on"===e.optin_settings.capture_emails?show_optins(e,set_result(e,set_result(e))):show_sharing_and_result_screen(e,set_result(e))}function show_optins(e,s){$(e.selector).find(".fca_qc_optin_input").tooltipster({trigger:"custom",maxWidth:240,theme:["tooltipster-borderless","tooltipster-quiz-cat"]}).tooltipster("close"),$(e.selector).find(".fca_qc_optin_container").show(),$(e.selector).find(".fca_qc_optin_input").first().focus(),$(e.selector).find(".fca_qc_skip_email_button").click(function(){$(e.selector).find(".fca_qc_optin_container").hide(),$(e.selector).find(".fca_qc_optin_input").tooltipster("close"),show_sharing_and_result_screen(e,s)}),$(e.selector).find(".fca_qc_submit_email_button").click(function(){var i=$(e.selector).find("#fca_qc_email_input").val(),t=$(e.selector).find("#fca_qc_name_input").val(),n=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,c=n.test(i),r=""!==t||0===$(e.selector).find("#fca_qc_name_input").length;$(e.selector).find(".fca_qc_optin_input").removeClass("fca_qc_invalid"),e.selector.offsetWidth=e.selector.offsetWidth,c&&r?($(document).unbind("keypress"),$(e.selector).find(".fca_qc_optin_input").tooltipster("close"),e.user={name:t,email:i},add_to_mailing_list(e,i,t,s),$(e.selector).find(".fca_qc_optin_container").hide(),show_sharing_and_result_screen(e,s)):(c?($(e.selector).find("#fca_qc_email_input").tooltipster("close"),$(e.selector).find("#fca_qc_email_input").removeClass("fca_qc_invalid")):($(e.selector).find("#fca_qc_email_input").tooltipster("open"),$(e.selector).find("#fca_qc_email_input").addClass("fca_qc_invalid")),r?($(e.selector).find("#fca_qc_name_input").tooltipster("close"),$(e.selector).find("#fca_qc_name_input").removeClass("fca_qc_invalid")):($(e.selector).find("#fca_qc_name_input").tooltipster("open"),$(e.selector).find("#fca_qc_name_input").addClass("fca_qc_invalid")))}),0===$(e.selector).find(".fca_qc_skip_email_button").length&&0===$(e.selector).find(".fca_qc_submit_email_button").length?show_sharing_and_result_screen(e,s):$(document).keypress(function(s){return 13===s.which?($(e.selector).find(".fca_qc_submit_email_button").click(),!1):void 0})}function add_to_mailing_list(e,s,i,t){if(fcaQcData.debug&&console.log(t),-1!==optins.indexOf(e.quiz_id))return console.log("already opted in for this quiz! woop"),!1;optins.push(e.quiz_id);var n=jstz.determine();$.ajax({url:e.ajaxurl,type:"POST",data:{nonce:e.nonce,post_id:e.quiz_id,action:"fca_qc_add_to_mailing_list",email:s,name:i,result:get_result_text(e,t),tags:t.tags,groups:t.groups,timezone:n.name()}}).done(function(e){console.log(e)})}function add_activity(e,s,i,t){if("shares"===t){if(-1!==shared.indexOf(i))return console.log("already shared this quiz! woop"),!1;shared.push(i)}else if("completions"===t){if(-1!==completed.indexOf(i))return console.log("already completed this quiz! woop"),!1;completed.push(i)}$.ajax({url:e,type:"POST",data:{nonce:s,quiz_id:i,action:"fca_qc_activity",type:t}}).done(function(e){console.log(e)})}function add_result(e,s,i,t){return-1!==results.indexOf(i)?(console.log("already stored results for this quiz! woop"),!1):(results.push(i),void $.ajax({url:e,type:"POST",data:{nonce:s,quiz_id:i,action:"fca_qc_add_result_ajax",result:t}}).done(function(e){console.log(e)}))}function add_response(e,s,i,t,n){$.ajax({url:e,type:"POST",data:{nonce:s,quiz_id:i,question:t,response:n,action:"fca_qc_add_response_ajax"}}).done(function(e){console.log(e)})}function send_responses(e,s){var i="",t="";e.hasOwnProperty("user")&&(i=e.user.name,t=e.user.email),$.ajax({url:e.ajaxurl,type:"POST",data:{nonce:e.nonce,quiz_id:e.quiz_id,name:i,email:t,result:s,responses:e.responses,action:"fca_qc_send_responses_ajax"}}).done(function(e){console.log(e)})}function restart_quiz(){location.reload()}function get_result_text(e,s){return"pt"===e.quiz_settings.quiz_type?s.title:s.title?e.score+"/"+e.questionCount+": "+s.title:e.score+"/"+e.questionCount}function show_sharing_and_result_screen(e,s){var i=get_result_text(e,s);send_responses(e,i),"redirect"===e.quiz_settings.result_mode?window.location.href=s.url:($(e.selector).find(".fca_qc_score_container").show(),"on"===e.quiz_settings.restart_button&&$("#fca_qc_restart_button").click(function(){restart_quiz(e),$(this).hide()}).show("fast"),"end"===e.hideAnswers&&show_responses(e),"on"===e.quiz_settings.show_sharing&&show_sharing(e,i))}function get_correct_answer_html(e){var s="",i="";return $(e.selector).find(".fca_qc_answer_div").each(function(){$(this).attr("data-question")===e.currentAnswer&&(s=addQuizImg($(this).find(".fca_qc_quiz_answer_img").attr("src")),i=$(this).find(".fca_qc_answer_span").html().replace(svg_square,""))}),s+i}function fix_hover(e){$(e.selector).find(".fca_qc_answer_div").hover(function(){$(this).addClass("fakehover")},function(){$(this).removeClass("fakehover")})}function show_sharing(e,s){$(e.selector).find(".fca_qc_social_share").show("fast");var i=$(e.selector).find(".fca_qc_score_img").attr("src");""===i&&(i=$(e.selector).find(".fca_qc_quiz_description_img").attr("src")),""===i&&(i=default_img);var t=$(e.selector).find("#fca_qc_share_link_facebook");1===t.length&&(encode_share_link(t,s),t.prop("href",t.prop("href")+"&picture="+i));var n=$(e.selector).find("#fca_qc_share_link_twitter");1===n.length&&encode_share_link(n,s);var c=$(e.selector).find("#fca_qc_share_link_email");1===c.length&&encode_share_link(c,s),iOS&&c.hide();var r=$(e.selector).find("#fca_qc_share_link_pinterest");1===r.length&&(encode_share_link(r,s),r.prop("href",r.prop("href")+"&media="+i)),$(e.selector).find(".fca_qc_share_link").click(function(s){s.preventDefault();var i=$(this).prop("href");window.open(i,"_blank","resizable=yes,scrollbars=yes,titlebar=yes, width=560, height=443, top=100, left=50"),add_activity(e.ajaxurl,e.nonce,e.quiz_id,"shares")})}function encode_share_link(e,s){var i=encodeURIComponent(e.data("sharestring").replace("{{MY_QUIZ_RESULT}}",s)),t=e.prop("href");e.prop("href",t+i)}function shuffleArray(e){for(var s=e.length-1;s>0;s--){var i=Math.floor(Math.random()*(s+1)),t=e[s];e[s]=e[i],e[i]=t}return e}function addQuizImg(e){return e&&""!==e&&"string"==typeof e?"<img class='fca_qc_quiz_answer_img' src='"+e+"'>":""}function scrollQuizInToView(e){var s=$(e).offset().top+-100;0>s&&(s=0),$("html, body").animate({scrollTop:s},300)}function debounce(e,s,i){var t;return function(){var n=this,c=arguments,r=function(){t=null,i||e.apply(n,c)},a=i&&!t;clearTimeout(t),t=setTimeout(r,s),a&&e.apply(n,c)}}var usingIE=detectIE(),iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,scoreString=$(".fca_qc_score_text").first().html(),svg_square='<svg xmlns="http://www.w3.org/2000/svg" class="fca_qc_rectancle" width="26" height="26"><rect style="fill: #fff; stroke: #000; stroke-width: 1;" width="26" height="26"></rect></svg>',quizzes={},default_img="";loadQuizzes(),fcaQcData.debug&&console.log(quizzes),preloadImages(),$(".fca_qc_start_button").click(function(){var e=quizzes[get_quiz_id($(this).closest(".fca_qc_quiz"))];add_activity(e.ajaxurl,e.nonce,e.quiz_id,"starts"),usingIE&&ieFix(e.selector),fix_hover(e),e.currentQuestion=0,e.score=0,e.responses=[],e.questionCount=e.questions.length,e.hideAnswers=""===e.quiz_settings.hide_answers?"after":"on"===e.quiz_settings.hide_answers?"end":e.quiz_settings.hide_answers,$(this).siblings(".fca_qc_quiz_title").hide(),$(this).siblings(".fca_qc_quiz_description").hide(),$(this).siblings(".fca_qc_quiz_description_img").hide(),$(this).hide(),$(this).siblings(".fca_qc_quiz_div").show(),$(this).siblings(".fca_qc_quiz_footer").show(),$(this).siblings(".flip-container").show(),$(this).siblings(".fca_qc_question_count").html("1/"+e.questionCount),showQuestion(e),scrollQuizInToView(e.selector)}),$(".fca_qc_next_question").click(function(){var e=quizzes[get_quiz_id($(this).closest(".fca_qc_quiz"))];usingIE?($(e.selector).find("#fca_qc_answer_container").show(),$(e.selector).find("#fca_qc_back_container").hide()):$(e.selector).find(".fca_qc_quiz_div").removeClass("flip"),showQuestion(e)}),$(".fca_qc_answer_div").click(function(){var e=quizzes[get_quiz_id($(this).closest(".fca_qc_quiz"))];scrollQuizInToView(e.selector),$(this).blur().removeClass("fakehover");var s=$(this).closest("#fca_qc_answer_container").data("id"),i=$(this).data("id"),t=!1;$(this).attr("data-question")===e.currentAnswer&&(e.score=e.score+1,t=!0);var n={answer:addQuizImg($(this).children(".fca_qc_quiz_answer_img").attr("src"))+$(this).children(".fca_qc_answer_span").html().replace(svg_square,""),answer:addQuizImg($(this).children(".fca_qc_quiz_answer_img").attr("src"))+$(this).children(".fca_qc_answer_span").html().replace(svg_square,""),isCorrect:t,correctAnswer:get_correct_answer_html(e),question:$(this).siblings("#fca_qc_question").html()};if("on"===e.quiz_settings.explanations){var c=e.questions[e.currentQuestion-1].answers.filter(function(e){return e.hasOwnProperty("hint")});1===c.length&&(n.hint=c[0].hint)}if(e.responses.push(n),add_response(e.ajaxurl,e.nonce,e.quiz_id,s,i),"pt"===e.quiz_settings.quiz_type)$.each($(this).data("results"),function(s,i){$.each(e.quiz_results,function(e,s){i===s.id&&(s.score=s.hasOwnProperty("score")?s.score+1:1)})}),showQuestion(e);else if("after"===e.hideAnswers){$(e.selector).find("#fca_qc_your_answer").html(addQuizImg($(this).children(".fca_qc_quiz_answer_img").attr("src"))+$(this).children(".fca_qc_answer_span").html().replace(svg_square,""));var r=get_correct_answer_html(e);if($(e.selector).find("#fca_qc_correct_answer").html(r),"on"===e.quiz_settings.explanations){var c=e.questions[e.currentQuestion-1].answers.filter(function(e){return e.hasOwnProperty("hint")});$(e.selector).find("#fca_qc_hint").html(1===c.length?c[0].hint:"")}usingIE?($(e.selector).find("#fca_qc_answer_container").hide(),$(e.selector).find("#fca_qc_back_container").show()):$(e.selector).find(".fca_qc_quiz_div").addClass("flip"),$(e.selector).find("#fca_qc_back_container").removeClass("correct-answer"),$(e.selector).find("#fca_qc_back_container").removeClass("wrong-answer"),t?($(e.selector).find("#fca_qc_back_container").addClass("correct-answer"),$(e.selector).find("#fca_qc_question_right_or_wrong").html(e.correct_string),$(e.selector).find("#fca_qc_correct_answer_p").hide()):($(e.selector).find("#fca_qc_back_container").addClass("wrong-answer"),$(e.selector).find("#fca_qc_question_right_or_wrong").html(e.wrong_string),$(e.selector).find("#fca_qc_correct_answer_p").show()),scale_flip_box_back(e.selector)}else showQuestion(e)});var optins=[],shared=[],completed=[],results=[],resizeWindow=debounce(function(){jQuery.each(quizzes,function(e){$(quizzes[e].selector).find("#fca_qc_answer_container").waitForImages(function(){maybe_add_quarter_class(quizzes[e].selector),scale_flip_box_question(quizzes[e].selector)})})},50);window.addEventListener("resize",resizeWindow)});